pre-commit:
  parallel: true
  commands:
    # ESLint - check for issues (no auto-fix)
    eslint:
      glob: '*.{js,mjs,ts,vue}'
      run: npm run lint:staged {staged_files}
      fail_text: '❌ ESLint found issues. Run "npm run lint:fix" to fix them and commit again.'

    # Prettier - check formatting (no auto-format)
    prettier:
      glob: '*.{js,mjs,ts,vue,json,md,yml,yaml,css,scss,html}'
      run: npm run format:check:staged {staged_files}
      fail_text: '❌ Code formatting issues found. Run "npm run format" to fix them and commit again.'

commit-msg:
  commands:
    conventional:
      run: |
        MSG_FILE="{1}"
        MSG="$(cat "$MSG_FILE")"
        FIRST_LINE="$(printf '%s' "$MSG" | head -n 1)"

        # Regex: optional scope, optional "!" for breaking change, and description
        REGEX="^(feat|fix|docs|style|refactor|perf|test|chore|build|ci)(\([^)]+\))?(!)?: .+"

        if ! echo "$FIRST_LINE" | grep -qE "$REGEX"; then
          echo "❌ Invalid commit message!"
          echo ""
          echo "Your commit message must follow the Conventional Commits format:"
          echo "   type(optional-scope)!?: description"
          echo ""
          echo "Allowed commit types:"
          echo "   feat | fix | docs | style | refactor | perf | test | chore | build | ci"
          echo ""
          echo "Rules:"
          echo " - A type is required."
          echo " - Scope is optional but must be inside parentheses when used."
          echo " - Add '!' after type or type(scope) to indicate a BREAKING CHANGE."
          echo " - A colon + space must follow type or type(scope) or type(scope)!"
          echo " - Multi-line commit messages are allowed — only the first line must match."
          echo ""
          echo "Valid examples:"
          echo "   feat: add user authentication"
          echo "   fix(server): resolve database connection issue"
          echo "   docs: update API documentation"
          echo "   style(ui): improve layout spacing"
          echo "   refactor!: remove deprecated API endpoints"
          echo "   feat(account)!: migrate user model schema"
          echo "   perf(api): improve query performance"
          echo "   ci(github-actions): fix build pipeline"
          echo ""
          exit 1
        fi
      skip:
        - merge
        - rebase

# Optional: pre-push hook for additional checks (uncomment to enable)
# pre-push:
#   commands:
#     # Type checking before push
#     typecheck:
#       run: npm run typecheck
#       fail_text: "❌ TypeScript type checking failed. Please fix type errors and try again."
#
#     # Run tests before pushing (if you have them)
#     # test:
#     #   run: npm run test
#     #   fail_text: "❌ Tests failed. Please fix failing tests and try again."

# Configuration
skip_output:
  - meta
  - success

colors: true
